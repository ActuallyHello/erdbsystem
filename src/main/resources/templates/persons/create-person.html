<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Home</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
</head>
</head>
<body>

<nav class="navbar is-primary is-mobile" role="navigation" aria-label="main navigation">
    <div id="navbarBasicExample" class="navbar-menu">
        <div class="navbar-start">
            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link">
                    Модели
                </a>
                <div class="navbar-dropdown">
                    <a class="navbar-item">
                        Все модели
                    </a>
                    <a class="navbar-item "> <!-- is-selected -->
                        Создать модель
                    </a>
                </div>
            </div>

            <a class="navbar-item">
                Задачи
            </a>

            <div class="navbar-item has-dropdown is-hoverable">
                <a class="navbar-link">
                    Пользователи
                </a>
                <div class="navbar-dropdown">
                    <a class="navbar-item">
                        Все пользователи
                    </a>
                    <a class="navbar-item " href="/create-person"> <!-- is-selected -->
                        Создать пользователя
                    </a>
                </div>
            </div>
        </div>

        <div class="navbar-end">
            <div class="navbar-item">
                <div class="buttons">
                    <a class="button is-light" id="open-modal">
                        Войти
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<div class="columns ml-6 mr-6 mt-2">
    <div class="column">
        <section class="hero is-small is-dark">
            <div class="hero-body">
                <p class="subtitle has-text-centered">Создать пользователя</p>
            </div>
        </section>

        <div class="box">
            <form id="create-person-form" action="/create-persons" method="POST">
                <div class="field">
                    <label class="label">Логин</label>
                    <div class="control">
                        <input class="input" type="text" placeholder="Введите логин" id="login" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Пароль</label>
                    <div class="control">
                        <input class="input" type="text" placeholder="Введите пароль" id="password" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Имя</label>
                    <div class="control">
                        <input class="input" type="text" placeholder="Введите пароль" id="firstname" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Фамилия</label>
                    <div class="control">
                        <input class="input" type="text" placeholder="Введите пароль" id="lastname" required>
                    </div>
                </div>

                <div class="field">
                    <label class="label">Отчество</label>
                    <div class="control">
                        <input class="input" type="text" placeholder="Введите пароль" id="middlename">
                    </div>
                </div>

                <div class="select">
                    <select id="person-type">
                        <option value="student">Студент</option>
                        <option value="teacher">Преподаватель</option>
                    </select>
                </div>

                <div class="select">
                    <select id="position">
                        <option value="">...</option>
                    </select>
                </div>


                <button type="submit" class="button is-link">Создать пользователя</button>

                <div id="response-message" class="notification is-hidden"></div>
            </form>
        </div>
    </div>
</div>


<script>
    window.onload = (event) => {
        console.log("page is fully loaded");

        const personType = document.getElementById('person-type');
        const positionSelect = document.getElementById('position');

        personType.onchange = async () => {
            console.log(positionSelect.value);

            const response = await fetch(`http://localhost:8080/enumeration-values/${personType.value}`);
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const data = await response.json(); // Предполагаем, что API возвращает JSON
            console.log("RESPONSE", data);

            positionSelect.innerHTML = '';
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id; // Предполагаем, что поля называются value
                option.textContent = item.label; // Предполагаем, что поля называются label
                positionSelect.appendChild(option);
            });
        };
    };

    const form = document.getElementById('create-person-form');

    form.onsubmit = async function(event) {
        event.preventDefault(); // Предотвращаем перезагрузку страницы

        const login = document.getElementById('login').value;
        const password = document.getElementById('password').value;
        const firstName = document.getElementById('firstname').value;
        const lastName = document.getElementById('lastname').value;
        const middleName = document.getElementById('middlename').value;
        const personType = document.getElementById('person-type').value;
        const position = document.getElementById('position').value;

        const responseMessage = document.getElementById('response-message');

        // Отправка POST-запроса
        try {
            const response = await fetch(`http://localhost:8080/create-persons`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ login, password, firstName, lastName, middleName, personType, position }),
            });

            if (response.ok) {
                const result = await response.json();
<!--                responseMessage.classList.remove('is-hidden', 'is-danger');-->
<!--                responseMessage.classList.add('is-success');-->
<!--                responseMessage.textContent = 'Пользователь успешно создан!';-->
            } else {
                const error = await response.json();
<!--                responseMessage.classList.remove('is-hidden', 'is-success');-->
<!--                responseMessage.classList.add('is-danger');-->
<!--                responseMessage.textContent = Ошибка: ${error.message};-->
            }
        } catch (error) {
<!--            responseMessage.classList.remove('is-hidden', 'is-success');-->
<!--            responseMessage.classList.add('is-danger');-->
<!--            responseMessage.textContent = 'Произошла ошибка при отправке запроса.';-->
        }
    };
</script>

</body>
</html>